@page "/notifications"

<PageHeader Title="Notifications" />

<Card>

    <FluentDataGrid Items="@notifications" ShowHover="true">
        <PropertyColumn Property="@(p => p.FromName)" />
        <PropertyColumn Property="@(p => p.Title)" />
        <PropertyColumn Property="@(p => p.Message)" />
        <PropertyColumn Property="@(p => p.CreatedOn)" />
    </FluentDataGrid>

    <Pagination PagedInfo=pageInfo OnPageNoChanged=GoToPageAsync />

</Card>

@code {
    private PagedInfo? pageInfo { get; set; }

    private NotificationLookup notificationLookup = new();

    private IQueryable<NotificationDto>? notifications;

    protected override async Task OnInitializedAsync()
    {
        await GoToPageAsync(1);
    }

    private async Task LoadDataAsync()
    {
        var getEntries = await NotificationService.GetAsync(notificationLookup);

        if (getEntries.Succeeded)
        {
            pageInfo = getEntries.PagedInfo;
            notifications = getEntries.Data.AsQueryable();
        }
    }

    private async Task GoToPageAsync(int page)
    {
        notificationLookup.Page = page;
        await LoadDataAsync();
    }
}